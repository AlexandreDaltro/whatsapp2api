"use strict"
//Code protected by Copyright
//Creator: Alexandre de Almeida Daltro
//Contact: contato@alexandredaltro.com.br

function setListeners(){setTimeout((()=>{document.querySelector("#main > header > div._24-Ff > div > div > span")?.addEventListener("click",getDataFromDOM),document.querySelector("#app > div > span:nth-child(4) > div > ul > div > div > li:nth-child(1)")?.addEventListener("click",getDataFromDOM),document.querySelector("button#select_messages")?.addEventListener("click",toggleCheckboxes),document.querySelector("button#send_data")?.addEventListener("click",sendData)}),200)}function toggleCheckboxes(){document.removeEventListener("click",setListeners);let e=document.querySelectorAll("#main > header > div._1yNrt > div > div"),t=e[e.length-1].childNodes[0].childNodes[0];t.click(),setTimeout((()=>{let e=document.querySelectorAll("#app > div > span:nth-child(4) > div > ul > div > div");for(let t in e=e[0].childNodes)if("Selecionar mensagens"==e[t].innerText||"Select Messages"==e[t].innerText){e[t].click();break}}),50),t.click(),document.addEventListener("click",setListeners)}async function handleWebhookJson(e,t){try{let n={mode:"no-cors",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:t};await fetch(e,n)}catch(e){}}function sendData(){let e=document.querySelectorAll("div#div_form_container > input"),t=document.querySelectorAll("#main > div._2gzeB > div > div._33LGR > div._3K4-L > div");var n=new Object;for(let e=0;e<t.length;e++)t[e].childNodes[0].childNodes[0]?.classList.contains("_3vy-1")&&(n[[e]]=t[e].innerText.replace(/\n/g,"\\n"));let i="{\n";for(let t=0;t<e.length;t++)i+=`"${e[t].id}":"${e[t].value}",\n`;for(let e in i+='"messages":"Whatsapp Messages: \\n',n)i+=`${n[e]}\\n\\n`;i+='"}',handleWebhookJson(e[0].value,i)}function firstNameLastName(e){let t=new Array;return t[0]=e?.match(/(?<=^[\W]+|^)[A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ]+/),t[1]=e?.match(/(?<=[\w]\s).*/),t}function getDataFromDOM(){let e=new Object;setTimeout((()=>{let t,n,i,s,d,a=document.querySelector("h2 > span.l7jjieqr.cw3vfol9.i0jNr.selectable-text.copyable-text"),o=document.querySelector("section > div._2P1rL._1is6W.ZIBLv.RVTrW > div.p357zi0d.ktfrpxia.nu7pwgvd.fhf7t426.f8m0rgwh.gndfcl4n > div > span > span"),r=document.querySelector("#app > div > div > div._3ArsE > div.ldL67._1bLj8 > span > div > span > div > div > section > div > div.gx1rr48f.Wt3HP > div > div > span > span"),c=document.querySelector("#app > div > div > div._3ArsE > div.ldL67._1bLj8 > span > div > span > div > div > section > div._2P1rL._1is6W.ZIBLv._1zkaQ._3uJPJ > div._25luK > div.IbzNe > div._9q4U3 > span"),l=document.querySelectorAll("#main > div._2gzeB > div > div._33LGR > div._3K4-L > div"),v=new Object;if(v.tel=/^[+][0-9]{2}[ ][0-9]{2,3}[ ][0-9]{4,5}[-][0-9]{4,5}$/,v.email=/[A-z-_.0-9]+[@][A-z.-_0-9]+/,v.company=/(?<=Site\/Instagram\sda\sempresa:\s).*/,v.photos_quantity=/(?<=Quantidade\sde\sfotos\sdesejada\sno\stotal:)[ 0-9]+/,v.product_types=/(?<=Tipos\sde\sProdutos:).*/,v.tel.test(a?.innerText))t=a.innerText,n=firstNameLastName(o?.innerText);else if(v.tel.test(o?.innerText))t=o?.innerText,n=firstNameLastName(a?.innerText);else{t=r?.innerText,n=firstNameLastName(c?.innerText);var u=!0}d=u?document.querySelector("section > div._2P1rL._1is6W.ZIBLv._2FcG4"):document.querySelector("#app > div > div > div._3ArsE > div.ldL67._1bLj8 > span > div > span > div > div > section > div._2P1rL._1is6W.ZIBLv.RVTrW > div._1Nfyf"),i=n[0],s=n[1],t=t.replace(/[\s-\.]/g,""),l.forEach((t=>{for(let n in v)t.innerText.match(v[n])&&(e[[n]]=t.innerText.match(v[n])[0])})),chrome.storage.sync.get(["alldata"],(n=>{let a=new Object,o=`<input id="url_to_post" type="hidden" value="${(a=n.alldata).urlToPost}"/>`;for(let n in o+=`<span>First name</span><input id="first_name" type="text" class="extension_form_input" value="${i}"/>`,o+=`<span>Last name</span><input id="last_name" type="text" class="extension_form_input" value="${s}"/>`,o+=`<span>Cellphone</span><input id="tel" type="text" class="extension_form_input" value="${t}"/>`,a.rows){a.rows[n].key;let t=a.rows[n].label,i=a.rows[n].id,s=a.rows[n].type,d="";"email"===i&&(d=e.email),o+=`<span>${t}</span><input id="${i}" type="${s}" class="extension_form_input" value="${d}"/>`}o+='<button id="select_messages" class="extension_form_button">Select Messages</button>';let r=`<div id="div_form_container" class="_1is6W _2P1rL ZIBLv e8k79tju bcymb0na myel2vfb i4pc7asj">${o+='<button id="send_data" class="extension_form_button">Send Data</button>'}</div>`;document.querySelector("div#div_form_container")?document.querySelector("div#div_form_container").innerHTML=o:d.insertAdjacentHTML("afterend",r)}))}),200),setListeners()}chrome.runtime.onMessage.addListener(((e,t,n)=>{"initReading"==e.command&&alert("Message received from click in the popup")})),document.addEventListener("click",setListeners);