"use strict"
//Code protected by Copyright
//Creator: Alexandre de Almeida Daltro
//Contact: contato@alexandredaltro.com.br

function setListeners(){console.log("click"),setTimeout(()=>{document.querySelector("#main > header > div._24-Ff > div > div > span")?.addEventListener("click",getDataFromDOM),document.querySelector("#app > div > span:nth-child(4) > div > ul > div > div > li:nth-child(1)")?.addEventListener("click",getDataFromDOM),document.querySelector("button#select_messages")?.addEventListener("click",toggleCheckboxes),document.querySelector("button#send_data")?.addEventListener("click",sendData),console.log("Listeners setted")},200)}function toggleCheckboxes(){console.log("toggleCheckboxes() Executed");let a;document.removeEventListener("click",setListeners);let b=document.querySelectorAll("#main > header > div._1yNrt > div > div"),c=b[b.length-1].childNodes[0].childNodes[0];console.log("Step 1: isPersonal: "+a),console.log("Step 3: isPersonal: "+a),c.click(),setTimeout(()=>{let a=document.querySelectorAll("#app > div > span:nth-child(4) > div > ul > div > div");for(let b in a=a[0].childNodes)if(console.log(a[b].innerText),"Selecionar mensagens"==a[b].innerText||"Select Messages"==a[b].innerText){(0,a[b]).click();break}},50),c.click(),document.addEventListener("click",setListeners)}async function handleWebhookJson(a,b){try{let c={mode:"no-cors",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:b};await fetch(a,c)}catch(d){console.log("Requisition Error",d)}}function sendData(){console.log("sendData() Executed");let d=document.querySelectorAll("div#div_form_container > input"),f=document.querySelectorAll("#main > div._2gzeB > div > div._33LGR > div._3K4-L > div");var b=new Object;for(let c=0;c<f.length;c++)f[c].childNodes[0].childNodes[0]?.classList.contains("_3vy-1")&&(b[[c]]=f[c].innerText.replace(/\n/g,"\\n"),console.log(b.length));let a="{\n";for(let e=0;e<d.length;e++)a+=`"${d[e].id}":"${d[e].value}",
`;for(let h in a+='"messages":"Whatsapp Messages: \\n',b)a+=`${b[h]}\\n\\n`;a+='"}',console.log(a),console.log(b);let g=d[0].value;console.log("webhook Link: "+g),handleWebhookJson(g,a)}function firstNameLastName(b){console.log("firstNameLastName() Executed");let a=new Array;return a[0]=b?.match(/(?<=^[\W]+|^)[A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ]+/),a[1]=b?.match(/(?<=[\w]\s).*/),console.log(a),a}function getDataFromDOM(){console.log("getDataFromDOM() Executed");let a=new Object;setTimeout(()=>{let e=document.querySelector("h2 > span.l7jjieqr.cw3vfol9.i0jNr.selectable-text.copyable-text"),f=document.querySelector("section > div._2P1rL._1is6W.ZIBLv.RVTrW > div.p357zi0d.ktfrpxia.nu7pwgvd.fhf7t426.f8m0rgwh.gndfcl4n > div > span > span"),h=document.querySelector("#app > div > div > div._3ArsE > div.ldL67._1bLj8 > span > div > span > div > div > section > div > div.gx1rr48f.Wt3HP > div > div > span > span"),i=document.querySelector("#app > div > div > div._3ArsE > div.ldL67._1bLj8 > span > div > span > div > div > section > div._2P1rL._1is6W.ZIBLv._1zkaQ._3uJPJ > div._25luK > div.IbzNe > div._9q4U3 > span"),j=document.querySelectorAll("#main > div._2gzeB > div > div._33LGR > div._3K4-L > div"),b=new Object;b.tel=/^[+][0-9]{2}[ ][0-9]{2,3}[ ][0-9]{4,5}[-][0-9]{4,5}$/,b.email=/[A-z-_.0-9]+[@][A-z.-_0-9]+/,b.company=/(?<=Site\/Instagram\sda\sempresa:\s).*/,b.photos_quantity=/(?<=Quantidade\sde\sfotos\sdesejada\sno\stotal:)[ 0-9]+/,b.product_types=/(?<=Tipos\sde\sProdutos:).*/;let c,d,k,l;if(b.tel.test(e?.innerText))c=e.innerText,d=firstNameLastName(f?.innerText);else if(b.tel.test(f?.innerText))c=f?.innerText,d=firstNameLastName(e?.innerText);else{c=h?.innerText,d=firstNameLastName(i?.innerText),console.log(e?.innerText);var g=!0;console.log("Is Business Account"+g)}let m;m=g?document.querySelector("section > div._2P1rL._1is6W.ZIBLv._2FcG4"):document.querySelector("#app > div > div > div._3ArsE > div.ldL67._1bLj8 > span > div > span > div > div > section > div._2P1rL._1is6W.ZIBLv.RVTrW > div._1Nfyf"),k=d[0],l=d[1],c=c.replace(/[\s-\.]/g,""),j.forEach(d=>{for(let c in b)d.innerText.match(b[c])&&(a[[c]]=d.innerText.match(b[c])[0])}),chrome.storage.sync.get(["alldata"],i=>{let d=new Object,b=`<input id="url_to_post" type="hidden" value="${(d=i.alldata).urlToPost}"/>`;for(let e in b+=`<span>First name</span><input id="first_name" type="text" class="extension_form_input" value="${k}"/>`,b+=`<span>Last name</span><input id="last_name" type="text" class="extension_form_input" value="${l}"/>`,b+=`<span>Cellphone</span><input id="tel" type="text" class="extension_form_input" value="${c}"/>`,d.rows){let o=d.rows[e].key,f=d.rows[e].label,g=d.rows[e].id,j=d.rows[e].type,h="";"email"===g&&(h=a.email),console.log(d),console.log("para cada row: "+f),b+=`<span>${f}</span><input id="${g}" type="${j}" class="extension_form_input" value="${h}"/>`,console.log(b)}b+='<button id="select_messages" class="extension_form_button">Select Messages</button>';let n=`<div id="div_form_container" class="_1is6W _2P1rL ZIBLv e8k79tju bcymb0na myel2vfb i4pc7asj">${b+='<button id="send_data" class="extension_form_button">Send Data</button>'}</div>`;document.querySelector("div#div_form_container")?(console.log("Menu j\xe1 Existe"),document.querySelector("div#div_form_container").innerHTML=b,console.log("div_form_container Reloaded")):m.insertAdjacentHTML("afterend",n)})},200),setListeners(),console.log("End of getDataFromDOM")}chrome.runtime.onMessage.addListener((a,b,c)=>{console.log("Message received from click"),"initReading"==a.command&&alert("Message received from click in the popup")}),document.addEventListener("click",setListeners)